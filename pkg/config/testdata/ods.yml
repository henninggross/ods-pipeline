phases:
  build:
    - name: backend-build-go
      params:
        - name: "go-image"
          value: "localhost:5000/ods/ods-go-toolset:latest"
        - name: "sonar-image"
          value: "localhost:5000/ods/ods-sonar:latest"
        - name: "go-os"
          value: "linux"
        - name: "go-arch"
          value: "amd64"
      taskRef:
        kind: ClusterTask
        name: ods-build-go-v0-1-0
      workspaces:
        - name: source
          workspace: shared-workspace

    - name: backend-build-image
      taskRef:
        kind: ClusterTask
        name: ods-build-image-v0-1-0
      runAfter:
        - backend-build-go
      params:
        - name: registry
          value: kind-registry.kind:5000
        - name: builder-image
          value: localhost:5000/ods/ods-buildah:latest
        - name: tls-verify
          value: "false"
      workspaces:
        - name: source
          workspace: shared-workspace

  deploy:
    - name: backend-deploy
      taskRef:
        kind: ClusterTask
        name: ods-deploy-helm-v0-1-0
      params:
        - name: release-name
          value: backend
        - name: image
          value: localhost:5000/ods/ods-helm:latest
      workspaces:
        - name: source
          workspace: shared-workspace

repositories:
  - name: foo
    branch: master
  - name: bar
    branch: master
